## 09-软件体系结构的设计和构建

### 9.1 软件体系结构设计过程

1. 分析关键需求和项目约束
2. 选择体系结构风格
3. 进行软件体系结构逻辑设计
4. 进行软件体系结构物理设计
5. 完善软件体系结构设计
6. 定义构件接口
7. 迭代过程 3 - 6

#### 9.1.1 分析关键需求和项目约束

软件体系结构设计的输入就是软件需求规格说明和项目约束，要先搞清楚用户需要做什么，以及在什么样的约束条件下做，是进行正确的后续设计的前提条件。

#### 9.1.2 选择体系结构风格

根据关键需求和项目约束来选择适合的体系结构风格。比如如果项目组开发人员都比较熟悉 web 技术，那么如果系统基于 web 开发就可以使用偏向 web 的MVC 风格。

#### 9.1.3 软件体系结构逻辑设计

1. 依据概要功能需求和体系结构风格建立初始设计

首先根据功能大概划分模块，然后将需求分配到子系统和模块，（考虑可复用性），并建立逻辑包，并识别出每个功能对逻辑包的依赖关系。

2. 使用非功能性需求和项目约束评价和改进初始设计

查看初步设计是否满足非功能需求和项目约束，改进初始设计

#### 9.1.4 软件体系结构实现

软件体系结构的逻辑视角描述的是一个抽象的系统，并不是一个实实在在的系统，所以，需要将软件体系结构的逻辑设计从开发、（开发包，物理模块）、发布（进程）、部署（网络部署）三个角度进行实现，建立体系结构的物理设计。

##### 一些物理包设计原则

1. common closure principle（共同封闭原则）
   - 一起修改的类要放在一个包内（修改应该尽可能限制在一个包内）
   - 为 programmer 带来好处（开发者）
2. common reuse principle（共同重用原则）
   - 一个包内的类应该一起被重用（避免不必要的依赖）
   - 对维护者有利

CCP 和 CRP 之间是存在矛盾的，CCP 倾向于让包变大， CRP 倾向于让包变小，一个合适的方案是在不同的阶段对两个原则给予不同的权重，在项目还没有稳定的时候主要注意 CCP ， 在项目稳定之后主要注意 CRP

3. Reuse-Release Equivalency Principle（重用发布等价原则）
   - 重用的单位也是发布的单位
   - 让维护者更轻松

前三条都是关于内聚性的原则。

4. The Acyclic Dependencies Principle（无环依赖原则）
   - 自顶向下地组织包依赖关系
   - 包的依赖关系应该组成一个 DAG，不应该存在循环依赖
   - 解决循环依赖的方式1：抽出一个依赖的共同部分，共同依赖这个包
   - 解决循环依赖的方式2：抽出一个接口，倒置依赖
5. Stable Dependencies Principle（稳定依赖原则）
   - 依赖要指向稳定的包
   - stability：effort required to change the package
   - 稳定性度量：输入耦合度Ca,位于包外且依赖于包内的类的类的数目，输出耦合度Ce, 位于包内并依赖于包外的类的类的数目，不稳定度 I = Ce/(Ca + Ce)
6. Stable Abstractions Principle(稳定抽象原则)
   - 稳定的包应该尽量抽象
   - 抽象使得修改更加容易
   - 不稳定的包应该尽量具体
   - 抽象性度量：包内抽象类个数/总的类个数

后三个原则是关于耦合性的原则。

#### 9.1.5 完善体系结构设计

1. 完善软件体系结构设计：分配职责到各个模块
2. 细化软件体系结构设计：分配职责到各个类，画出关键类图，指明接口的数据对象

### 9.2 体系结构的原型构建

#### 9.2.1 包的创建

#### 9.2.2 重要文件的创建

#### 9.2.3 定义构件之间的接口

接口编写（必考）
1. 接口来源于哪？
刺激响应序列和详细规格
逻辑层接口，来源于需求，刺激响应序列。
刺激是输入的参数，响应是返回值
数据层接口来源于逻辑层代码，增删改查，逻辑层要什么就提供什么
2. 接口怎么定？
刺激响应构成一个接口

#### 9.2.4 关键需求的实现

### 9.3 体系结构和集成测试

#### 集成策略

1. 大爆炸式
   - 一次性将所有模块组合在一起
2. 增量式
   - 自顶向下
     - 按照深度优先可以首先实现和验证一个完整的功能需求
     - 只需要顶端的一个驱动
     - 利于故障定位
     - 桩的开发量大
     - 低层组件验证被推迟，且测试不充分
   - 自底向上
     - 对低层组件较早验证
     - 低层组件开发可以并行
     - 利于故障定位
     - 桩的开发量小
     - 驱动开发量大
     - 对于高层的验证被推迟，不容易发现高层设计上的缺陷
   - 三明治式
   - 持续集成
     - 防止软件开发过程中出现无法集成和无法发布的状况
     - 有利于检查和发现集成缺陷

### 9.4 软件体系结构设计文档描述

### 9.5 软件体系结构评审